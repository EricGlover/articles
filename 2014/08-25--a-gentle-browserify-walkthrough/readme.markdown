<sub>&#x1F6A8; <strong>Autogenerated!</strong> See <a href="https://github.com/ponyfoo/articles/tree/noindex/contributing.markdown"><code>contributing.markdown</code></a> for details. See also: <a href="https://ponyfoo.com/articles/a-gentle-browserify-walkthrough">web version</a>.</sub>

<a href="https://ponyfoo.com/articles/a-gentle-browserify-walkthrough"><div></div></a>

<h1>A Gentle Browserify Walkthrough</h1>

<p><kbd>browserify</kbd> <kbd>modules</kbd> <kbd>front-end</kbd> <kbd>tutorial</kbd></p>

<blockquote><p>Building modules for the front-end has become an increasingly easy problem to solve. Back in the nineties we had our Java applets, our <code>&lt;MARQUEE&gt;</code> and <code>&lt;BLINK&gt;</code> &#x2026;</p></blockquote>

<div><p>Building modules for the front-end has become an increasingly easy problem to solve. Back in the nineties we had our Java applets, our <code class="md-code md-code-inline">&lt;MARQUEE&gt;</code> and <code class="md-code md-code-inline">&lt;BLINK&gt;</code> tag combinations, and those beloved <code class="md-code md-code-inline">&lt;CENTER&gt;</code> tags. Oh and we were mostly developing on Front Page. Anyways, time to <strong>wean off the nostalgia</strong>. Let&#x2019;s focus.</p></div>

<blockquote></blockquote>

<div><p>This time around I want to focus on <a href="http://browserify.org/" target="_blank">Browserify</a>, a lean build step you can take to obtain <a href="http://wiki.commonjs.org/wiki/CommonJS" target="_blank">CommonJS</a> modules in your browser <strong>today</strong>. You have no idea what CommonJS modules are or why you need them? <em>Keep on reading!</em></p> <p><a href="http://browserify.org/" target="_blank"><img src="https://i.imgur.com/tYvbZwb.png" alt="browserify.png"></a></p> <p>CommonJS is a module format for JavaScript, widely adopted by the <a href="http://nodejs.org/" target="_blank">Node.js</a> community and popularized by <a href="https://www.npmjs.org/" target="_blank">npm</a>, the package manager that&#x2019;s bundled with Node. In this article you&#x2019;ll learn about CommonJS and how you can bring those same modules to your client-side code, using <a href="http://browserify.org/" target="_blank">Browserify</a> and maybe a build tool to automate your processes.</p> <p>Browserify is one of those tools that the open-source community almost takes for granted, whereas it&#x2019;s overlooked by the vast majority of companies, hardly making its way into projects in a professional setting. Not all is lost, sometimes big companies <em>do the right thing</em> and use it to develop <a href="http://requirejs.org/" target="_blank">their open-source projects</a>.</p> <p>If you&#x2019;re still stuck with <a href="https://github.com/facebook/react/" target="_blank">AMD modules</a> and their sheet-piles of documentation at work, then maybe you should consider Browserify for a change.</p></div>

<div><p>I could name quite a few reasons why <strong>you should be using Browserify today</strong>. First, let&#x2019;s talk about <a href="http://wiki.commonjs.org/wiki/CommonJS" target="_blank" aria-label="CommonJS specification">Common.JS</a>.</p> <p><a href="http://wiki.commonjs.org/wiki/CommonJS" target="_blank" aria-label="CommonJS specification"><img alt="commonjs.png" class="" src="https://cloud.githubusercontent.com/assets/934293/3831513/6fd5d336-1d94-11e4-868b-4f1165e6600e.jpg"></a></p> <p>CommonJS is the open module format specification behind the Node.js platform. That sounds overly complicated, but its not. CommonJS revolves around a few very straightforward rules.</p> <blockquote> <p>Every file you use is a &#x201C;module&#x201D;. Modules are a 1-to-1 mapping to files</p> </blockquote> <p>The above just means that in CommonJS you have a single entry point, which is a CommonJS module file, and everything is loaded from there. Implicitly, this signifies that module loading happens synchronously, but you could still use multiple entry points, placing each on its own <code class="md-code md-code-inline">&lt;script&gt;</code> tag, and even have them interact with each other. This means that while CommonJS is easily bundled together you can also <em>&#x201C;partition&#x201D;</em> your bits into several modules and serve them progressively rather than offload everything to the browser at once.</p> <p>As a quick example, here&#x2019;s a module that prints numbers from <code class="md-code md-code-inline">1</code> to <code class="md-code md-code-inline">30</code> in your <code class="md-code md-code-inline">console</code>. Let&#x2019;s say the file is named <code class="md-code md-code-inline">app.js</code>.</p> <pre class="md-code-block"><code class="md-code md-lang-javascript"><span class="md-code-keyword">var</span> i = <span class="md-code-number">0</span>;

<span class="md-code-keyword">for</span> (; i++ <span><span class="md-code-tag">&lt; <span class="md-code-attribute">30</span>; ) {
  <span class="md-code-attribute">console.log</span>(<span class="md-code-attribute">i</span>);
}
</span></span></code></pre> <p>If you wanted to try this module out, you could download and install <a href="http://nodejs.org/" target="_blank" aria-label="Node.js application development platform">Node.js</a>, fire up a terminal, and type in the following command.</p> <pre class="md-code-block"><code class="md-code md-lang-javascript">node app
</code></pre> <p>One of the most important benefits of using CommonJS lies in how scoping behaves in its modules. Let&#x2019;s compare it with typical behavior in browsers.</p> <h1 id="differences-in-scoping">Differences in Scoping</h1> <p>In the browser, you might be used to an implicit global <code class="md-code md-code-inline">window</code> scope. This typically forces us to wrap our code with <code class="md-code md-code-inline">functions</code> on every JavaScript file, creating closures so that the implicit scope is no longer the global object.</p> <p>For example, in the browser, you might be used to the following behavior.</p> <pre class="md-code-block"><code class="md-code md-lang-xml"><span class="md-code-tag">&lt;<span class="md-code-title">script</span> <span class="md-code-attribute">src</span>=<span class="md-code-value">&apos;foo.js&apos;</span>&gt;</span><span></span><span class="md-code-tag">&lt;/<span class="md-code-title">script</span>&gt;</span>
<span class="md-code-tag">&lt;<span class="md-code-title">script</span> <span class="md-code-attribute">src</span>=<span class="md-code-value">&apos;bar.js&apos;</span>&gt;</span><span></span><span class="md-code-tag">&lt;/<span class="md-code-title">script</span>&gt;</span>
</code></pre> <pre class="md-code-block"><code class="md-code md-lang-javascript"><span class="md-code-comment">// foo.js</span>

<span class="md-code-keyword">var</span> i = <span class="md-code-number">0</span>;

<span class="md-code-keyword">for</span> (; i++ <span><span class="md-code-tag">&lt; <span class="md-code-attribute">30</span>; ) {
  <span class="md-code-attribute">console.log</span>(<span class="md-code-attribute">i</span>);
}
</span></span></code></pre> <pre class="md-code-block"><code class="md-code md-lang-javascript"><span class="md-code-comment">// bar.js</span>

<span class="md-code-built_in">console</span>.log(i);
<span class="md-code-comment">// &lt;- 31</span>
</code></pre> <p>In order to work around that, you&#x2019;d go ahead and create a closure in the <code class="md-code md-code-inline">foo</code> module, preventing <code class="md-code md-code-inline">i</code> to leak into the global object and spill information to the other camp_, <em>&#x2026;err,</em> file.</p> <pre class="md-code-block"><code class="md-code md-lang-javascript"><span class="md-code-comment">// foo.js</span>

<span class="md-code-keyword">void</span> <span class="md-code-function"><span class="md-code-keyword">function</span> <span class="md-code-params">()</span> </span>{
  <span class="md-code-keyword">var</span> i = <span class="md-code-number">0</span>;

  <span class="md-code-keyword">for</span> (; i++ <span><span class="md-code-tag">&lt; <span class="md-code-attribute">30</span>; ) {
    <span class="md-code-attribute">console.log</span>(<span class="md-code-attribute">i</span>);
  }
}();
</span></span></code></pre> <pre class="md-code-block"><code class="md-code md-lang-javascript"><span class="md-code-comment">// bar.js</span>

<span class="md-code-built_in">console</span>.log(i);
<span class="md-code-comment">// &lt;- ReferenceError: i is not defined</span>
</code></pre> <p>CommonJS has <strong>implicit local scopes</strong>, meaning that variables declared at the top of a module&#x2019;s scope won&#x2019;t leak into the global object, but rather remain contained within the module where they&#x2019;re declared. Of course, you could always publish properties on the global object, by being explicit about it.</p> <pre class="md-code-block"><code class="md-code md-lang-javascript">global.warming = <span class="md-code-literal">true</span>;
</code></pre> <p>While <em>possible</em>, it&#x2019;s <strong>not recommended</strong>. CommonJS encourages us to establish inter-module communications through API declarations.</p> <blockquote> <p>Modules can export an API by setting <code class="md-code md-code-inline">module.exports</code></p> </blockquote> <p>Modules can publish a public API to <code class="md-code md-code-inline">module.exports</code>. If they do so, other modules will be able to access this API. Consider it the public interface of the module.</p> <pre class="md-code-block"><code class="md-code md-lang-javascript"><span class="md-code-keyword">var</span> i = <span class="md-code-number">1</span>;
<span class="md-code-keyword">var</span> max = <span class="md-code-number">30</span>;

<span class="md-code-built_in">module</span>.exports = <span class="md-code-function"><span class="md-code-keyword">function</span> <span class="md-code-params">()</span> </span>{
  <span class="md-code-keyword">for</span> (i -= <span class="md-code-number">1</span>; i++ <span><span class="md-code-tag">&lt; <span class="md-code-attribute">max</span>; ) {
    <span class="md-code-attribute">console.log</span>(<span class="md-code-attribute">i</span>);
  }
  <span class="md-code-attribute">max</span> *= <span class="md-code-attribute">1.1</span>;
};
</span></span></code></pre> <p>In the example shown above, both <code class="md-code md-code-inline">i</code> and <code class="md-code md-code-inline">max</code> are only accessible internally by our module, while consumers will be able to access the <code class="md-code md-code-inline">function</code> that we&#x2019;re exporting, and invoke it as often as they please. You aren&#x2019;t limited to exposing <code class="md-code md-code-inline">function</code>s but you can actually expose any API you want, which is typically an <code class="md-code md-code-inline">object</code> or an <a href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/#factorypatternjavascript" target="_blank" aria-label="The Factory Pattern explained by Addy Osmani">object factory</a> method.</p> <blockquote> <h6 id="trivia">Trivia</h6> <p>Note that the CommonJS <code class="md-code md-code-inline">exports</code> specification didn&#x2019;t originally allow exporting <code class="md-code md-code-inline">function</code>s, but Node has allowed it since its early days with the <a href="http://nodejs.org/api/modules.html#modules_module_exports" target="_blank" aria-label="Documentation for module.exports"><code class="md-code md-code-inline">module.exports</code></a> alternative, for convenience.</p> </blockquote> <p>The counterpart to exposing an API via <code class="md-code md-code-inline">module.exports</code> is consuming another module&#x2019;s API. Let&#x2019;s look into that one.</p> <blockquote> <p>Modules can consume the API exposed by other modules using the <code class="md-code md-code-inline">require(module)</code> method, where <code class="md-code md-code-inline">module</code> is the relative path from the file where the require statement is executed, to the location of the module we want to import is located</p> </blockquote> <p>Again, it&#x2019;s simpler than it sounds. Suppose you have a <code class="md-code md-code-inline">print.js</code> file and a <code class="md-code md-code-inline">printer.js</code> file in the same directory. You&#x2019;d have <code class="md-code md-code-inline">printer.js</code> expose the API we&#x2019;ve been fiddling with.</p> <pre class="md-code-block"><code class="md-code md-lang-javascript"><span class="md-code-keyword">var</span> i = <span class="md-code-number">1</span>;
<span class="md-code-keyword">var</span> max = <span class="md-code-number">30</span>;

<span class="md-code-built_in">module</span>.exports = {
  print: <span class="md-code-function"><span class="md-code-keyword">function</span> <span class="md-code-params">()</span> </span>{
    <span class="md-code-keyword">for</span> (i -= <span class="md-code-number">1</span>; i++ <span><span class="md-code-tag">&lt; <span class="md-code-attribute">max</span>; ) {
      <span class="md-code-attribute">console.log</span>(<span class="md-code-attribute">i</span>);
    }
    <span class="md-code-attribute">max</span> *= <span class="md-code-attribute">1.1</span>;
  }
};
</span></span></code></pre> <p>Then there&#x2019;s <code class="md-code md-code-inline">print.js</code> which does the actual printing. Loading other modules happens synchronously and directly in your JavaScript code. You can omit the <code class="md-code md-code-inline">.js</code> extension for brevity. You can also assign the results of requiring a module to a variable, or you can choose not to do that.</p> <pre class="md-code-block"><code class="md-code md-lang-javascript"><span class="md-code-keyword">var</span> printer = <span class="md-code-built_in">require</span>(<span class="md-code-string">&apos;./printer&apos;</span>);

printer.print();
printer.print();
printer.print();
printer.print();
</code></pre> <p>Again, you could run this example with Node by entering the command below into a terminal.</p> <pre class="md-code-block"><code class="md-code md-lang-bash">node <span class="md-code-built_in">print</span>
</code></pre> <p>A <code class="md-code md-code-inline">require</code>d module will only be interpreted once. This means that calls to <code class="md-code md-code-inline">require(&apos;./printer&apos;)</code> won&#x2019;t reset <code class="md-code md-code-inline">i</code> after the module has been interpreted once. In fact, the interface exported by <a href="http://nodejs.org/api/modules.html#modules_caching" target="_blank" aria-label="Module caching documentation by Node.js">the module is cached</a>, and that is returned every time. You could fiddle with the caching behavior by removing entries from the cache, but it&#x2019;s considered a bad practice unless you have a legitimate reason to go there.</p> <h3 id="but-what-about-the-browser">But what about the browser?</h3> <p>So far, the CommonJS modules you&#x2019;ve been looking at in this article work perfectly fine under a Node.js execution environment, but this article started out talking about the front-end. I wanted to first introduce you to the type of modules you&#x2019;d be earning by making the switch to <a href="http://browserify.org/" target="_blank" aria-label="Browserify lets you require(&apos;modules&apos;) in the browser by bundling up all of your dependencies">Browserify</a>, so first I had to explain how CommonJS works.</p> <p>Now that that&#x2019;s out of the way, let&#x2019;s throw some questions at the discussion.</p> <ul> <li>Why is CommonJS &#x201C;better&#x201D; than <em><a href="https://ponyfoo.com/2014/01/09/gulp-grunt-whatever" aria-label="Gulp, Grunt, Whatever">&#x201C;whatever&#x201D;</a></em>, or than using AMD?</li> <li>Doesn&#x2019;t this cripple my development productivity?</li> <li>How do I bring these modules to the browser?</li> <li>What other benefits can I get from using CommonJS modules?</li> <li>What are some advanced use cases?</li> </ul> <p>I&#x2019;ll go through these in turn, hoping to answer your concerns when it comes to using CommonJS in the browser through Browserify.</p> <h1 id="why-commonjs">Why CommonJS?</h1> <p>As I covered earlier, CommonJS gives you <strong>true modules</strong> contained in by <em>individual files</em>, but first let&#x2019;s look at the <strong>reasons why you might want to ditch the alternatives</strong>.</p> <h4 id="why-not-whatever">Why not <em>&#x201C;whatever&#x201D;</em>?</h4> <p>The idea of using nothing, while appealing, poses no benefit other than feeling nostalgic about those Java Applets you used to adore.</p> <ul> <li>You are required to create a closure in every piece of code that you write, otherwise you risk leaks to the global object</li> <li>You need to figure out your own system to develop modular components, and be consistent about it too</li> <li>You need to <a href="http://en.wikipedia.org/wiki/Dependency_graph" target="_blank" aria-label="Dependency Graph as defined by Wikipedia">&#x201C;compute the dependency graph&#x201D;</a> by yourself, which is a nice way of saying you have to stack your <code class="md-code md-code-inline">&lt;script&gt;</code> tag deck in order to make sure that parts of your application that depend on other pieces of code come after the pieces they depend upon</li> </ul> <p><img alt="dependency-graph.png" class="" src="https://cloud.githubusercontent.com/assets/934293/3849717/2f96edc6-1e7c-11e4-9de5-0a53f93fcd82.png"></p> <p>Note that, in this section, I&#x2019;m not speaking about ES6 modules because they need a lot of work until we can use it natively in <a href="https://github.com/yui/yui3/wiki/Graded-Browser-Support#a-grade" target="_blank" aria-label="A-grade browsers according to Yahoo">A-grade browsers</a> and we can consider them <em>&#x201C;using nothing&#x201D;</em>. Everyone pretty much agrees on this one, though. Let&#x2019;s move to RequireJS.</p> <h4 id="why-not-requirejs-10">Why not <a href="http://requirejs.org/" target="_blank" aria-label="RequireJS Module Loader">RequireJS</a>?</h4> <p>RequireJS is a module loader based on the AMD specification. While I personally dislike it, this way of approaching modularity is a popular alternative to CommonJS. It does provide a solution to modularity, dependency injection, and a built-in solution to the dependency graph issue, which is always a great thing.</p> <p>That being said, there are <em>some issues</em> with RequireJS.</p> <ul> <li>Too <strong>verbose</strong>. It basically needs us to wrap our code in closures using <code class="md-code md-code-inline">define</code> and <code class="md-code md-code-inline">require</code> statements</li> <li>Overly <strong>complex</strong>. Have you seen the <a href="http://requirejs.org/docs/api.html" target="_blank" aria-label="RequireJS API Documentation">documentation on the RequireJS site</a>? Jesus! Every little thing means you need to adjust and tweak your configuration to be just so for that specific corner-case. That&#x2019;s not very <a href="https://ponyfoo.com/2014/08/05/building-high-quality-front-end-modules" aria-label="Building High-Quality Front-End Modules">high-quality</a> of them</li> <li><em>Compatibility issues</em> with libraries that don&#x2019;t conform to their standards</li> <li>Wildly different development and production distributions</li> </ul> <p>During development RequireJS provides <a href="https://ponyfoo.com/2013/05/13/the-web-wars" aria-label="The Web Wars">a super-asynchronous API</a> that enables modules to be loaded through AJAX as dependencies are resolved. For release, the recommended approach is to compile the modules into one or many bundles. As usual, RequireJS provides <a href="http://requirejs.org/docs/optimization.html" target="_blank" aria-label="RequireJS Optimization Documentation">a boatload of documentation on the subject</a>. <em>Way more</em> than you&#x2019;d ever want to know about a module system.</p> <blockquote> <p>To me, these are all just indicators of <strong>poor design</strong>.</p> </blockquote> <p>Fine, I <strong>don&#x2019;t like</strong> RequireJS. For the record, I would <strong>still prefer it over not doing anything</strong>. Currently, the reasons why I prefer CommonJS over ES6 has nothing to do with ES6 and everything to do with the features that CommonJS boasts.</p> <ul> <li>Straightforward, familiar syntax</li> <li>Code sharing with Node.js</li> <li>Access to <a href="http://npmjs.org/" target="_blank" aria-label="Node Packaged Modules">all of <code class="md-code md-code-inline">npm</code></a></li> </ul> <p>The syntax familiarity point is a minor one, but I&#x2019;ll expand on these items later in the article.</p> <h1 id="doesn-t-this-cripple-my-productivity">Doesn&#x2019;t this cripple my productivity?</h1> <p>You probably think that a build step which needs you to <strong>bundle your code together even during development</strong> is a nightmare from a day-to-day development productivity point of view. Thanks to the <a href="https://ponyfoo.com/2014/01/09/gulp-grunt-whatever" aria-label="Gulp, Grunt, Whatever">myriad of tools</a> that are available to us, this is <em>not that big</em> of a deal when it comes to <strong>Continuous Development</strong> (the ability to rebuild the compiled bundle whenever your code changes). When it comes to productivity we take a <strong>speed hit</strong> because we have to wait for the build step to complete after we make changes to our code.</p> <p>Then there&#x2019;s also the fact that <strong>bundled-up pieces of code make debugging hard</strong>, because stack traces and logging statements end up referencing line numbers that don&#x2019;t match your source code. Luckily Browserify has great support for <a href="http://www.html5rocks.com/en/tutorials/developertools/sourcemaps/" target="_blank" aria-label="Introduction to JavaScript Source Maps">source maps</a>, which can point the browser to the sources of compiled assets. It&#x2019;s just a matter of setting the <code class="md-code md-code-inline">--debug</code> option on the command-line, or <code class="md-code md-code-inline">debug</code> when using the programmatic API.</p> <h1 id="how-do-i-bring-these-modules-to-the-browser">How do I bring these modules to the browser?</h1> <p>Using <a href="http://browserify.org/" target="_blank" aria-label="Browserify lets you require(&apos;modules&apos;) in the browser by bundling up all of your dependencies">Browserify</a>! It&#x2019;s quite easy. Here&#x2019;s <em>what you need</em> to know.</p> <p>First off, you can run Browserify using its <a href="https://github.com/substack/node-browserify#usage" target="_blank" aria-label="Browserify CLI Usage Documentation on GitHub">CLI</a>, its <a href="https://github.com/substack/node-browserify#api-example" target="_blank" aria-label="Browserify API Example Documentation on GitHub">API</a>, the <a href="https://github.com/jmreidy/grunt-browserify" target="_blank" aria-label="grunt-browserify on GitHub">Grunt plugin</a>, <a href="https://github.com/gulpjs/plugins/issues/47" target="_blank" aria-label="gulp-browserify is blacklisted">piping into <code class="md-code md-code-inline">gulp.dest</code></a>, the <a href="https://github.com/gingerhendrix/broccoli-browserify" target="_blank" aria-label="broccoli-browserify on GitHub">Broccoli plugin</a>, etc. Instead of documenting each and every one of these ways to run Browserify I&#x2019;ll keep my examples to the CLI, which translates quite nicely to what the API and the plugins expect you to do.</p> <p>In the <code class="md-code md-code-inline">printer</code> example shown earlier, for example, compiling the code so that it works in the browser would just be a matter of using the command shown below.</p> <pre class="md-code-block"><code class="md-code md-lang-bash">browserify print.js &gt; dist/app.js
</code></pre> <p>You could also use the <code class="md-code md-code-inline">-o</code> flag, indicating the destination file.</p> <pre class="md-code-block"><code class="md-code md-lang-bash">browserify print.js -o dist/app.js
</code></pre> <p>This is most useful if you need to run the task whenever your code changes. To that end, you&#x2019;ll use the specialized <a href="https://github.com/substack/watchify" target="_blank" aria-label="substack/watchify on GitHub"><code class="md-code md-code-inline">watchify</code> tool</a>. Then, when your code changes, <code class="md-code md-code-inline">watchify</code> will make sure to recompile the bundle. Watchify has the same API as the regular <code class="md-code md-code-inline">browserify</code> CLI does, which is super convenient for us.</p> <pre class="md-code-block"><code class="md-code md-lang-bash">npm install -g watchify
</code></pre> <pre class="md-code-block"><code class="md-code md-lang-bash">watchify print.js -o dist/app.js
</code></pre> <p>If you wanted to generate <strong>a source map</strong>, you&#x2019;d only have to add the <code class="md-code md-code-inline">-d</code> option.</p> <pre class="md-code-block"><code class="md-code md-lang-bash">browserify print.js -do dist/app.js
</code></pre> <pre class="md-code-block"><code class="md-code md-lang-bash">watchify print.js -do dist/app.js
</code></pre> <p>There&#x2019;s also an extensive list of &#x201C;transforms&#x201D; that allow you to do neat things during compilation. For instance, if you <a href="https://ponyfoo.com/2013/09/28/we-dont-want-your-coffee" aria-label="We don&apos;t want your Coffee">love CoffeeScript like I do</a>, you could use the <a href="https://github.com/jnordberg/coffeeify" target="_blank" aria-label="coffeeify on GitHub"><code class="md-code md-code-inline">coffeeify</code></a> transform as shown below.</p> <pre class="md-code-block"><code class="md-code md-lang-bash">browserify print.coffee -t coffeeify -o dist/app.js
</code></pre> <p>There&#x2019;s <em>tons</em> of other transforms you could use. Make sure to <a href="https://github.com/substack/node-browserify/wiki/list-of-transforms" target="_blank" aria-label="List of Browserify transforms on GitHub">consult the wiki page</a>, you&#x2019;ll probably find what you need in there. Another transform that you may find super helpful is <a href="https://github.com/substack/brfs" target="_blank" aria-label="substack/brfs on GitHub"><code class="md-code md-code-inline">brfs</code></a>. That transform works by inlining calls to <code class="md-code md-code-inline">fs.readFileSync</code> into your client-side bundles. This means that we could have a <code class="md-code md-code-inline">cool-sites.txt</code> file and a piece of code like the one shown below, and compile it into something that works on the browser!</p> <pre class="md-code-block"><code class="md-code md-lang-javascript"><span class="md-code-keyword">var</span> fs = <span class="md-code-built_in">require</span>(<span class="md-code-string">&apos;fs&apos;</span>);
<span class="md-code-keyword">var</span> sites = fs.readFileSync(__dirname + <span class="md-code-string">&apos;/cool-sites.txt&apos;</span>, { encoding: <span class="md-code-string">&apos;utf8&apos;</span> });

sites.split(<span class="md-code-string">&apos;\n&apos;</span>).forEach(<span class="md-code-function"><span class="md-code-keyword">function</span> <span class="md-code-params">(site, i)</span> </span>{
  <span class="md-code-built_in">console</span>.log(<span class="md-code-string">&apos;%s: %s is pretty cool&apos;</span>, i, site);
});
</code></pre> <pre class="md-code-block"><code class="md-code">ponyfoo.com
github.com
codepen.com
newsblur.com
twitter.com
</code></pre> <p>Oh, <code class="md-code md-code-inline">__dirname</code> is a special variable that&#x2019;s local to every CommonJS module, and it contains the path to the directory for that module. Similarly, <code class="md-code md-code-inline">__filename</code> is the module&#x2019;s file name. The compiler will be smart enough to figure out the result of <code class="md-code md-code-inline">__dirname + &apos;/cool-sites.txt&apos;</code> statically. The compiler <strong>isn&#x2019;t able to handle most cases</strong> where you try to dynamically calculate the file path, so using <code class="md-code md-code-inline">path.join</code> and the like won&#x2019;t be possible. This is unfortunate because its a common scenario in Node.js, however, it rarely comes up in modules that are meant for the browser. You could compile the code above using the command below.</p> <pre class="md-code-block"><code class="md-code md-lang-bash">browserify sites.js -t brfs -o dist/app.js
</code></pre> <p>Fortunately, there&#x2019;s a way you could work around the static file path problem, but it takes a little bit of work.</p> <h3 id="working-around-static-file-paths">Working around static file paths</h3> <p>When the <strong>static file-naming</strong> situation gets the best of you, you could work around it by doing something similar to what I did in <a href="https://github.com/bevacqua/taunus" target="_blank" aria-label="bevacqua/taunus on GitHub">Taunus</a>, where I created a CLI that creates a <a href="https://github.com/bevacqua/taunus/blob/b4524b1d7d74a620e40de38fad54d2f33d998f76/bin/taunus#L15-L34" target="_blank" aria-label="Relevant lines in the Taunus CLI">static file containing route definitions and then requires that into the bundle</a>, <em>effectively annuling</em> the limitation. I was able to do that because I had to <code class="md-code md-code-inline">require</code> a ton of files defined in a server-side route definition file, but I didn&#x2019;t want to have the consumer repeat that information in a very similar format for the client-side. Due to the limitation in Browserify, I couldn&#x2019;t just create a for loop either, so I worked around it with a generator. This generator ends up unrolling the <code class="md-code md-code-inline">for</code> loop, as shown in the example below, taken from Pony Foo&#x2019;s <a href="https://github.com/ponyfoo/ponyfoo/tree/redo" target="_blank" aria-label="bevacqua/ponyfoo/redo on GitHub"><code class="md-code md-code-inline">redo</code> branch</a>.</p> <pre class="md-code-block"><code class="md-code md-lang-javascript"><span class="md-code-keyword">var</span> controllers = {
  <span class="md-code-string">&apos;author/compose&apos;</span>: <span class="md-code-built_in">require</span>(<span class="md-code-string">&apos;../../client/js/controllers/author/compose.js&apos;</span>),
  <span class="md-code-string">&apos;home/index&apos;</span>: <span class="md-code-built_in">require</span>(<span class="md-code-string">&apos;../../client/js/controllers/home/index.js&apos;</span>)
};
 
<span class="md-code-keyword">var</span> routes = {
  <span class="md-code-string">&apos;/&apos;</span>: <span class="md-code-string">&apos;home/index&apos;</span>,
  <span class="md-code-string">&apos;/account/login&apos;</span>: <span class="md-code-string">&apos;account/login&apos;</span>,
  <span class="md-code-string">&apos;/author/compose&apos;</span>: <span class="md-code-string">&apos;author/compose&apos;</span>
};
 
<span class="md-code-built_in">module</span>.exports = {
  templates: templates,
  controllers: controllers,
  routes: routes
};
</code></pre> <p>Problem solved! That&#x2019;s a file Browserify <strong>does understand</strong>.</p> <h1 id="what-other-benefits-can-i-get-from-using-commonjs-modules">What other benefits can I get from using CommonJS modules?</h1> <p>Besides being <em>&#x201C;not as bad as the alternatives&#x201D;</em>, CommonJS has a few things going for it on its own. Earlier on, I mentioned a few benefits of using CommonJS. Time to go through them.</p> <blockquote> <ul> <li>Straightforward, familiar syntax</li> <li>Code sharing with Node.js</li> </ul> </blockquote> <p>If you&#x2019;re a Node developer, <a href="http://browserify.org/" target="_blank" aria-label="Browserify lets you require(&apos;modules&apos;) in the browser by bundling up all of your dependencies">Browserify</a> will feel like <a href="http://en.wikipedia.org/wiki/Architect_(The_Matrix)" target="_blank" aria-label="You know the one.">the Architect</a>&#x2019;s gift to you. Being able to leverage the CommonJS syntax in the client-side too opens your applications up to a world of opportunities. A big one of those is the ability to share an identical code base between the server and the client side. Quite a few libraries out there have some degree of cross-platform_ity_ built into them, perhaps using <a href="https://github.com/umdjs/umd" target="_blank" aria-label="Universal Module Definition">the UMD pattern</a>. The twist in using Browserify is that you get to use CommonJS just like in Node, and you can avoid the UMD boilerplate, as well as any other boilerplate.</p> <blockquote> <p>Access to <a href="http://npmjs.org/" target="_blank" aria-label="Node Packaged Modules">all of <code class="md-code md-code-inline">npm</code></a></p> </blockquote> <p>Perhaps the most significant of the benefits in using CommonJS modules is that there are <strong>so, so many</strong> modules written in CommonJS and published to <code class="md-code md-code-inline">npm</code>. In my experience it has almost always been easy to find a module that did what I needed to do, and most of them work as expected. While there&#x2019;s also <a href="http://bower.io/" target="_blank" aria-label="bower.io">Bower</a>, <a href="https://github.com/component/component" target="_blank" aria-label="component/component on GitHub">Component</a> and others out there, the module-mentality in Node.js camps is much stronger than in other areas.</p> <blockquote> <p>Note that <strong>Component seems like it&#x2019;s dying</strong>. The site has been down <a href="https://github.com/component/component/issues/587" target="_blank" aria-label="component.io site down">for a month now</a>, and <a href="https://www.npmjs.org/package/duo" target="_blank" aria-label="duo on npmjs.org">duo</a> seems to be going to be its successor.</p> </blockquote> <p>With a little work, you could also use modules that are written under other formats such as AMD or by publishing a global object. In order to make such modules work for us, we could use <a href="https://github.com/thlorenz/browserify-shim" target="_blank" aria-label="browserify-shim on GitHub"><code class="md-code md-code-inline">browserify-shim</code></a>, which makes it quite easy.</p> <p>There&#x2019;s <a href="http://stackoverflow.com/a/23129051/389745" target="_blank" aria-label="How do I use Browserify with external dependencies?">a StackOverflow answer</a> that details the process. I&#x2019;ve copied part of the answer below.</p> <blockquote> <p>Install <code class="md-code md-code-inline">browserify-shim</code>.</p> <pre class="md-code-block"><code class="md-code md-lang-bash">npm install browserify-shim --save-dev
</code></pre> <p>Then tell <code class="md-code md-code-inline">browserify</code> to use <code class="md-code md-code-inline">browserify-shim</code> as a transform in <code class="md-code md-code-inline">package.json</code>.</p> <pre class="md-code-block"><code class="md-code md-lang-json">{
  &quot;<span class="md-code-attribute">browserify</span>&quot;: <span class="md-code-value">{
    &quot;<span class="md-code-attribute">transform</span>&quot;: <span class="md-code-value">[ <span class="md-code-string">&quot;browserify-shim&quot;</span> ]
  </span>}
</span>}
</code></pre> <p>In <code class="md-code md-code-inline">package.json</code> map <code class="md-code md-code-inline">jQuery</code> to the <code class="md-code md-code-inline">jQuery</code> object published on the global scope.</p> <pre class="md-code-block"><code class="md-code md-lang-json">{
  &quot;<span class="md-code-attribute">browserify-shim</span>&quot;: <span class="md-code-value">{
    &quot;<span class="md-code-attribute">jQuery</span>&quot;: <span class="md-code-value"><span class="md-code-string">&quot;global:jQuery&quot;</span>
   </span>}
</span>}
</code></pre> <p>Lastly, run <code class="md-code md-code-inline">browserify</code>.</p> <pre class="md-code-block"><code class="md-code md-lang-bash">browserify mymodule.js &gt; bundle.js
</code></pre> </blockquote> <p>Let&#x2019;s move on to our last topic of discussion!</p> <h1 id="what-are-some-advanced-use-cases">What are some advanced use cases?</h1> <p>One of the most advantageous ways in which you could use Borwserify is to share code between the server and the browser. This enables you to communicate seamlessly, and to produce <strong>an API that&#x2019;s consistent on both sides</strong> of the wire.</p> <p>Take <a href="https://github.com/bevacqua/poser" target="_blank" aria-label="bevacqua/poser on GitHub">poser</a> for example. It allows you to grab out-of-context prototypes such as clean <code class="md-code md-code-inline">Array</code> or <code class="md-code md-code-inline">Object</code> prototypes. On the server-side, it&#x2019;ll use the <a href="http://nodejs.org/api/vm.html" target="_blank" aria-label="Node core vm module">vm</a> core module provided by Node.js, while on the browser it&#x2019;ll resort to <code class="md-code md-code-inline">&lt;iframe&gt;</code> DOM elements to achieve the same goal.</p> <p>Besides adjusting an API to the environment, Browserify can also help you connect the dots between both sides of a communication, as seen in frameworks like <a href="https://github.com/Automattic/socket.io" target="_blank" aria-label="Automattic/socket.io on GitHub">Socket.io</a>, which handles realtime connections between the client and the server in a seamless manner, almost giving the consumer the feeling that both sides have the same capabilities.</p> <p>In some other cases, it&#x2019;s not so much about the underlying implementation changing according to the environment, but merely being able to consistently execute a piece of logic, without resorting to code duplication. Such is the case of <a href="https://github.com/bevacqua/ultramarked" target="_blank" aria-label="bevacqua/ultramarked on GitHub">ultramarked</a>, which can produce consistent HTML from Markdown in any environment. The nice thing about Node.js being in JavaScript is that you don&#x2019;t have to re-implement your server-side libraries in JavaScript, because they&#x2019;re already in that language!</p> <blockquote> <p><strong>Browserify your front-end away!</strong></p> </blockquote> <p>Here&#x2019;s a few related articles for you to chew on.</p> <ul> <li><a href="https://ponyfoo.com/2014/08/05/building-high-quality-front-end-modules" aria-label="Building High-Quality Front-End Modules">Building High-Quality Front-End Modules</a></li> <li><a href="https://ponyfoo.com/2014/01/09/gulp-grunt-whatever" aria-label="Gulp, Grunt, Whatever">Gulp, Grunt, Whatever</a></li> <li><a href="https://github.com/substack/browserify-handbook" target="_blank" aria-label="Browserify Handbook by Substack">Browserify Handbook</a> (written by Substack)</li> <li><a href="http://blakeembrey.com/articles/introduction-to-browserify/" target="_blank" aria-label="require(&#x2018;modules&#x2019;) in the browser.">Introduction to Browserify</a></li> <li><a href="https://blog.codecentric.de/en/2014/02/cross-platform-javascript/" target="_blank" aria-label="Sharing Code Between Node.js and the Browser">Cross-platform JavaScript with Browserify</a></li> </ul></div>
